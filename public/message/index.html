<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <meta name="theme-color" content="#0d0d0d">
    
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://platform.twitter.com">

    

    
        <meta name="description" content="anonymously write or draw me a message.">
        
            <link rel="canonical" href="https://mufeedvh.com/message/">
        
        <meta property="og:locale" content="en_US">
        
            <meta property="og:type" content="website">
        
        <meta property="og:title" content="message">
        <meta property="og:description" content="anonymously write or draw me a message.">
        
            <meta property="og:image" content="https://mufeedvh.com/assets/images/vista-background.jpg">
            <meta property="og:image:alt" content="message">
        
        
            <meta property="og:url" content="https://mufeedvh.com/message/">
        
        <meta property="og:site_name" content="Mufeed VH">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@mufeedvh">
        <meta name="twitter:creator" content="@mufeedvh">
        <meta name="twitter:title" content="message">
        <meta name="twitter:description" content="anonymously write or draw me a message.">
        
            <meta name="twitter:image" content="https://mufeedvh.com/assets/images/vista-background.jpg">
        
    

    <title>
    
        
            message - Mufeed VH
        
    
</title>
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/fonts/TiemposHeadline-Regular.otf" as="font" type="font/otf" crossorigin>
    <link rel="preload" href="/assets/fonts/TiemposText-Regular.otf" as="font" type="font/otf" crossorigin>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap" rel="stylesheet">
    
    <style>
    .content code:not(pre code),
    .code-block-wrapper pre code,
    .code-line-numbers div {
        font-family: 'Fira Code' !important;
    }
    
    @font-face {
        font-family: TiemposHeadline-Regular;
        src: url("/assets/fonts/TiemposHeadline-Regular.otf") format("opentype");
        font-display: swap;
    }
    @font-face {
        font-family: TiemposText-Regular;
        src: url("/assets/fonts/TiemposText-Regular.otf") format("opentype");
        font-display: swap;
    }
    body {
        background-color: #0d0d0d;
        color: #e0e0e0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: left;
        min-height: 100vh;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
    }
    .content {
        padding: 20px;
        width: 600px;
        max-width: 90%;
        margin: 20px auto;
        box-sizing: border-box;
        text-align: justify;
        font-family: TiemposText-Regular, Georgia, serif;
        position: relative;
    }
    .content h1 {
        font-family: TiemposHeadline-Regular, Georgia, serif;
        font-size: 2em;
        color: #ffffff;
        margin-top: 1em;
        margin-bottom: 0.5em;
    }
    .content a {
        font-family: TiemposHeadline-Regular, Georgia, serif;
        color: #a855f7;
        text-decoration: none;
        transition: all 0.2s ease;
    }
    .content p {
        text-align: justify;
        text-justify: inter-word;
        margin: 1em 0;
        line-height: 1.7;
    }
    .no-bullets {
        list-style-type: none;
        margin: 0;
        padding: 0;
    }
    .theme-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 48px;
        height: 48px;
        background-color: #1a1a1a;
        border: 2px solid #444;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 1000;
        opacity: 0.6;
        color: #e0e0e0;
        font-size: 1.2em;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    }
    @media screen and (max-width: 768px) {
        .content {
            width: 100%;
            max-width: 100%;
            padding: 15px;
            margin: 10px auto;
        }
        .theme-toggle {
            width: 44px;
            height: 44px;
            bottom: 15px;
            right: 15px;
        }
    }
    </style>
    
    <link rel="preload" href="/styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/frutiger-aero.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="/styles.css">
        <link rel="stylesheet" href="/frutiger-aero.css">
    </noscript>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script defer src="/codeblock-enhancer.js"></script>

    
        <link rel="alternate" type="application/rss+xml" title="RSS" href="https://mufeedvh.com/rss.xml">
    
    
    
        
    
    
    
    
    
</head>
<body>
    <div class="content">
        <div id="vista-titlebar" class="vista-titlebar">
            <div class="vista-titlebar-text">Mufeed VH</div>
            <div class="vista-titlebar-controls">
                <span class="vista-control vista-minimize">
                    <i class="fa-solid fa-window-minimize"></i>
                </span>
                <span class="vista-control vista-maximize">
                    <i class="fa-regular fa-window-maximize"></i>
                </span>
                <span class="vista-control vista-close">
                    <i class="fa-solid fa-xmark"></i>
                </span>
            </div>
        </div>
        
        
    
        
        
        <p>write or draw me a message <strong>anonymously</strong>.</p>
<style>
    textarea {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
        width: 100%;
        padding: 5px;
        font-size: 20px;
        border-radius: 10px;
        border-width: 0px;
    }

    .paint-canvas {
        width: 100%;
        height: 400px;
        background: white;
        border-width: 0px;
        border-radius: 10px;
        display: block;
        margin-top: 10px;
        touch-action: none;
    }
</style>
<div>
    <div class="center-content">
        <p style="font-size: 20px;"><strong>‚úçÔ∏è send a message</strong></p>
        <textarea id="message" rows="10"></textarea>
        <div class="button-wrapper"><h4 class="post-button" id="msg-button" onclick="send_message();">
            Send Message</h4></div> 
    </div>
    <hr>
    <div class="center-content">    
        <p style="font-size: 20px;"><strong>üñåÔ∏è send a drawing</strong></p>
        <input type="color" class="js-color-picker color-picker">
        <input type="range" class="js-line-range" min="1" max="72" value="1">
        &nbsp
        <label class="js-range-value">1</label> px
        <canvas class="js-paint paint-canvas"></canvas>
        <div class="button-wrapper"><h4 class="post-button" id="draw-button" onclick="send_drawing();">
            Send Drawing</h4></div> 
    </div>
</div>
<script>
    (function initializeDrawingModule() {
        const paintCanvas = document.querySelector('.js-paint');

        if (!paintCanvas) {
            console.error('[paint-canvas] Canvas element not found; drawing has been disabled.');
            return;
        }

        const context = paintCanvas.getContext('2d');
        const tempCanvas = document.createElement('canvas');
        const tempContext = tempCanvas.getContext('2d');
        const colorPicker = document.querySelector('.js-color-picker');
        const lineWidthRange = document.querySelector('.js-line-range');
        const lineWidthLabel = document.querySelector('.js-range-value');

        /**
         * Drawing module orchestrates a temporary off-screen canvas and the main canvas to create smooth
         * strokes, while ensuring the rendering space matches the device pixel ratio.
         *
         * Security considerations: logs emit only sizing metadata and configuration changes, never PII.
         */
        if (!context || !tempContext) {
            console.error('[paint-canvas] Failed to obtain a 2D rendering context; drawing has been disabled.');
            return;
        }

        let currentStrokeStyle = colorPicker ? colorPicker.value : '#000000';
        let currentLineWidth = lineWidthRange ? parseInt(lineWidthRange.value, 10) || 1 : 1;

        const logPaintEvent = (message, data = {}) => {
            console.info('[paint-canvas]', message, data);
        };

        const applyStrokeSettings = () => {
            context.lineCap = 'round';
            context.lineJoin = 'round';
            context.lineWidth = currentLineWidth;
            context.strokeStyle = currentStrokeStyle;

            tempContext.lineCap = 'round';
            tempContext.lineJoin = 'round';
            tempContext.lineWidth = currentLineWidth;
            tempContext.strokeStyle = currentStrokeStyle;
        };

        const detectMob = () => window.innerWidth <= 800;

        /**
         * Resize both canvases to follow layout changes and honour the device pixel ratio. Resetting the
         * transform on each call prevents cumulative scaling that previously displaced strokes below the
         * user's cursor.
         */
        const resizeCanvas = () => {
            const rect = paintCanvas.getBoundingClientRect();

            if (!rect.width || !rect.height) {
                console.warn('[paint-canvas] Skipping resize due to zero-sized bounding rectangle.', {
                    width: rect.width,
                    height: rect.height
                });
                return;
            }

            const dpr = window.devicePixelRatio || 1;

            paintCanvas.width = rect.width * dpr;
            paintCanvas.height = rect.height * dpr;
            tempCanvas.width = rect.width * dpr;
            tempCanvas.height = rect.height * dpr;

            paintCanvas.style.width = `${rect.width}px`;
            paintCanvas.style.height = `${rect.height}px`;
            tempCanvas.style.width = `${rect.width}px`;
            tempCanvas.style.height = `${rect.height}px`;

            context.setTransform(1, 0, 0, 1, 0, 0);
            tempContext.setTransform(1, 0, 0, 1, 0, 0);

            context.scale(dpr, dpr);
            tempContext.scale(dpr, dpr);

            applyStrokeSettings();

            logPaintEvent('Canvas resized', {
                width: rect.width,
                height: rect.height,
                dpr
            });
        };

        if (detectMob()) {
            paintCanvas.style.height = '320px';
        }

        if (colorPicker) {
            colorPicker.addEventListener('change', event => {
                currentStrokeStyle = event.target.value;
                applyStrokeSettings();
                logPaintEvent('Stroke colour changed', { stroke: currentStrokeStyle });
            });
        }

        if (lineWidthRange && lineWidthLabel) {
            lineWidthLabel.innerHTML = currentLineWidth;
            lineWidthRange.addEventListener('input', event => {
                const width = parseInt(event.target.value, 10) || 1;
                currentLineWidth = width;
                lineWidthLabel.innerHTML = width;
                applyStrokeSettings();
                logPaintEvent('Line width changed', { width: currentLineWidth });
            });
        }

        applyStrokeSettings();

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', resizeCanvas);
        } else {
            resizeCanvas();
        }

        window.addEventListener('resize', resizeCanvas);

        let isDrawing = false;
        let points = [];
        let savedImageData = null;

        /**
         * Convert a pointer event into canvas-relative coordinates using CSS pixels so the drawing logic can
         * stay agnostic of the backing store resolution.
         */
        const getPointerPosition = (canvas, evt) => {
            const rect = canvas.getBoundingClientRect();
            if ('touches' in evt && evt.touches.length) {
                const touch = evt.touches[0];
                return {
                    x: touch.clientX - rect.left,
                    y: touch.clientY - rect.top
                };
            }

            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        };

        /**
         * Render a smoothed stroke following the historical pointer trail, using quadratic curves for a
         * natural brush appearance.
         */
        const drawSmoothLine = (inputPoints, ctx) => {
            if (inputPoints.length === 0) {
                return;
            }

            ctx.beginPath();
            ctx.moveTo(inputPoints[0].x, inputPoints[0].y);

            for (let i = 1; i < inputPoints.length - 2; i++) {
                const xc = (inputPoints[i].x + inputPoints[i + 1].x) / 2;
                const yc = (inputPoints[i].y + inputPoints[i + 1].y) / 2;
                ctx.quadraticCurveTo(inputPoints[i].x, inputPoints[i].y, xc, yc);
            }

            if (inputPoints.length > 2) {
                const last = inputPoints.length - 1;
                ctx.quadraticCurveTo(inputPoints[last - 1].x, inputPoints[last - 1].y, inputPoints[last].x, inputPoints[last].y);
            }

            ctx.stroke();
        };

        const startDrawing = event => {
            isDrawing = true;
            points = [];
            points.push(getPointerPosition(paintCanvas, event));
            savedImageData = context.getImageData(0, 0, paintCanvas.width, paintCanvas.height);
        };

        const draw = event => {
            if (!isDrawing) {
                return;
            }

            event.preventDefault();
            points.push(getPointerPosition(paintCanvas, event));

            if (savedImageData) {
                context.putImageData(savedImageData, 0, 0);
            }

            drawSmoothLine(points, context);
        };

        const stopDrawing = () => {
            if (!isDrawing) {
                return;
            }

            isDrawing = false;
            
            if (savedImageData) {
                context.putImageData(savedImageData, 0, 0);
            }
            
            drawSmoothLine(points, context);
            points = [];
            savedImageData = null;
        };

        paintCanvas.addEventListener('mousedown', startDrawing);
        paintCanvas.addEventListener('mousemove', draw);
        paintCanvas.addEventListener('mouseup', stopDrawing);
        paintCanvas.addEventListener('mouseout', stopDrawing);

        paintCanvas.addEventListener('touchstart', startDrawing);
        paintCanvas.addEventListener('touchmove', draw);
        paintCanvas.addEventListener('touchend', stopDrawing);

        const API_URL = 'https://api.mufeedvh.com';

        const send_message = () => {
            const xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function() {
                if (this.readyState === 4 && this.status === 200) {
                    const token = JSON.parse(this.responseText).token;
                    console.log('acquired token: ' + token);

                    const message = document.getElementById('message').value;
                    const innerXhttp = new XMLHttpRequest();
                    const url = API_URL + '/message';

                    innerXhttp.onreadystatechange = function() {
                        if (this.readyState === 4 && this.status === 200) {
                            const button = document.getElementById('msg-button');
                            button.style.backgroundColor = 'lightgreen';
                            button.innerHTML = JSON.parse(innerXhttp.responseText).message;
                        } else if (this.readyState === 4 && this.status !== 200) {
                            const button = document.getElementById('msg-button');
                            button.style.color = 'white';
                            button.style.backgroundColor = 'red';
                            button.innerHTML = 'Failed to send message';
                        }
                    };

                    innerXhttp.open('POST', url);
                    innerXhttp.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
                    innerXhttp.send(JSON.stringify({
                        'token': token,
                        'message': message
                    }));
                }
            };

            xhttp.open('GET', API_URL + '/get_token', true);
            xhttp.send();
        };

        const send_drawing = () => {
            const xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function() {
                if (this.readyState === 4 && this.status === 200) {
                    const token = JSON.parse(this.responseText).token;
                    console.log('acquired token: ' + token);

                    const innerXhttp = new XMLHttpRequest();
                    const url = API_URL + '/drawing';

                    innerXhttp.onreadystatechange = function() {
                        if (this.readyState === 4 && this.status === 200) {
                            const button = document.getElementById('draw-button');
                            button.style.backgroundColor = 'lightgreen';
                            button.innerHTML = JSON.parse(innerXhttp.responseText).message;
                        } else if (this.readyState === 4 && this.status !== 200) {
                            const button = document.getElementById('draw-button');
                            button.style.color = 'white';
                            button.style.backgroundColor = 'red';
                            button.innerHTML = 'Failed to send message';
                        }
                    };

                    innerXhttp.open('POST', url);
                    innerXhttp.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
                    innerXhttp.send(JSON.stringify({
                        'token': token,
                        'message': paintCanvas.toDataURL()
                    }));
                }
            };

            xhttp.open('GET', API_URL + '/get_token', true);
            xhttp.send();
        };

        window.send_message = send_message;
        window.send_drawing = send_drawing;
    })();
</script>
    
    <a href="/">&#8592; Back to home</a>

    </div>
    
    <div id="theme-toggle" class="theme-toggle" title="Toggle Frutiger Aero Theme">
        <i class="fa-solid fa-sun"></i>
    </div>
    
    
    <script defer src="/theme-toggle.js"></script>
    <script defer src="/tweet-theme-override.js"></script>
    
    <script>
    function toggleSidenote(id) {
        const sidenote = document.getElementById(id);
        if (sidenote) {
            sidenote.classList.toggle('active');
        }
    }

    if (!window.sidenotesInitialized) {
        window.sidenotesInitialized = true;
        
        function initializeSidenotes() {
            const markers = document.querySelectorAll('.sidenote-marker');
            markers.forEach(marker => {
                const sidenoteId = marker.getAttribute('data-sidenote');
                const sidenote = document.getElementById(sidenoteId);
                if (sidenote) {
                    // Reset any inline styles that might interfere
                    sidenote.style.top = '';
                    sidenote.style.position = '';
                    
                    // Add click handler for desktop hover behavior
                    if (window.innerWidth >= 1200) {
                        marker.addEventListener('click', function(e) {
                            e.preventDefault();
                            // Close all other sidenotes
                            document.querySelectorAll('.sidenote').forEach(note => {
                                if (note.id !== sidenoteId) {
                                    note.classList.remove('active');
                                }
                            });
                            // Toggle current sidenote
                            sidenote.classList.toggle('active');
                        });
                    }
                }
            });
        }

        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                initializeSidenotes();
            }, 100);
        });
        
        // Initialize sidenotes with robust ready check
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeSidenotes);
        } else {
            // DOM already loaded - use setTimeout to ensure all elements are parsed
            setTimeout(initializeSidenotes, 0);
        }
    }
    </script>
    
</body>
</html>
